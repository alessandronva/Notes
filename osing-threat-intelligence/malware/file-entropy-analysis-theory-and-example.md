# File entropy analysis (Theory & Example)

REMnux provides a nice range of command-line tools that allow for bulk or semi-automated classification and static analysis. File entropy is very indicative of the suspiciousness of a file and is a prominent characteristic that these tools look for within a Portable Executable (PE).\
At it's very simplest, file entropy is a rating that scores how random the data within a PE file is. With a scale of 0 to 8. 0 meaning the less "randomness" of the data in the file, where a scoring towards 8 indicates this data is more "random".\
For example, files that are encrypted will have a very high entropy score. Where files that have large chunks of the same data such as "1's" will have a low entropy score.\
Okay...so?\
Malware authors use techniques such as encryption or packing (we'll come onto this next) to obfuscate their code and to attempt to bypass anti-virus. Because of this, these files will have high entropy. If an analyst had 1,000 files, they could rank the files by their entropy scoring, of course, the files with the higher entropy should be analysed first.\
To illustrate, this file would have a low entropy because the data has a pattern to it.

![](https://i.imgur.com/4lgx8FM.png)

\
Whereas however, this file would have a high entropy because there's no pattern to the data - it's a lot more random in comparison.\


![](https://i.imgur.com/kX0JcNy.png)

\
Packing and Unpacking\
I briefly discussed this in my   [MAL: Introductory](https://tryhackme.com/room/malmalintroductory) room, but that doesn't do this topic justice.\
We'll start with a bit of theory (so bare with me here) on how packing works and why it's used. Packer's use an executable as a source and output's it to another executable. This executable will have had some modifications made depending on the packer. For example, the new executable could be compressed and/or obfuscated by using mathematics.\
Legitimate software developers use packing to reduce the size of their applications and to ultimately protect their work from being stolen. It is, however, a double-edged sword, malware authors reap the benefits of packing to make the reverse engineering and detection of the code hard to impossible.\
\
Executables have what's called an entry point. When launched, this entry point is simply the location of the first pieces of code to be executed within the file - as illustrated below:\


![](https://i.imgur.com/gZgqg2n.png)

&#x20;                              _(Sikorski and Honig, 2012)_\
When an executable is packed, it must unpack itself before any code can execute. Because of this, packers change the entry point from the original location to what's called the "Unpacking Stub".

![](https://i.imgur.com/zKEDArl.png)

&#x20;                             _(Sikorski and Honig, 2012)_\
The "Unpacking Stub" will begin to unpack the executable into its original state. Once the program is fully unpacked, the entry point will now relocate back to its normal place to begin executing code:

![](https://i.imgur.com/o3dRrTh.png)

&#x20;                      _(Sikorski and Honig, 2012)_\
\
It is only at this point can an analyst begin to understand what the executable is doing as it is now in it's true, original form.\
Determining if an Executable is Packed\
Don't worry, learning how to manually unpack an executable is out-of-scope for this pathway. We have a few tools at our arsenal that should do a sufficient job for most of the samples we come across in the wild.\
Packed files have a few characteristics that may indicate whether or not they are packed:

* Remember about file entropy? Packed files will have a high entropy!\

* There are very few "Imports", packed files may only have "GetProcAddress" and "LoadLibrary".
* The executable may have sections named after certain packers such as UPX.

Demonstration\
I have two copies of my application, one not packed and another has been packed.\
Below we can see that this copy has 34 imports, so a noticeable amount and the imports are quite revealing in what we can expect the application to do:\
![](https://i.imgur.com/HdG2Gol.png)\
\
Whereas the other copy only presents us with 6 imports.\
![](https://i.imgur.com/5TZ8pa5.png)\
\
We can verify that this was packed using UPX via tools such as [PEID](https://www.aldeid.com/wiki/PEiD), or by manually comparing the executables sections and filesize differences.\
![](https://i.imgur.com/jgp7geN.png)\
\
Look at that entropy! 7.526 out of 8! Also, note the name of the sections. `UPX0` and the entry point being at `UPX1`...that's our packer.\
![](https://i.imgur.com/BKlrTA0.png)\
Answer the questions below
