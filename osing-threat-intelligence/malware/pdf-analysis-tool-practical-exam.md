# PDF analysis tool (Practical exam

We'll be using `peepdf`to begin a precursory analysis of a PDF file to determine the presence of Javascript. If there is, we will extract this Javascript code (without executing it) for our inspection.

We can simply do `peepdf demo_notsuspicious.pdf:`

\


<figure><img src="https://i.imgur.com/yBhDeYi.png" alt=""><figcaption></figcaption></figure>

Note the output confirming that there's Javascript present, but also how it is executed? OpenAction will execute the code when the PDF is launched.

To extract this Javascript, we can use `peepdf`'s "extract" module. This requires a few steps to set up but is fairly trivial.

The following command will create a script file for `peepdf` to use:

1\. `echo 'extract js > javascript-from-demo_notsuspicious.pdf' > extracted_javascript.txt`

\


<figure><img src="https://i.imgur.com/hYUwXuu.png" alt=""><figcaption></figcaption></figure>

The script will extract all javascript via `extract js` and pipe `>` the contents into "javascript-from-demo\_notsuspicious.pdf"\


We now need to tell `peepdf` the name of the script (extracted\_javascript.txt) and the PDF file that we want to extract from (demo\_notsuspicious.pdf):&#x20;

2\. `peepdf -s extracted_javascript.txt demo_notsuspicious.pdf`

Remembering that the Javascript will output into a file called "javascript-from-demo\_nonsuspicious.pdf" because of our script.

To recap: "extracted\_javascript.txt" (highlighted in red) is our script, where "demo\_notsuspicious.pdf" (highlighted in green) is the original PDF file that we think is malicious.\


<img src="https://i.imgur.com/0q0dt9I.png" alt="" data-size="line">\
\
You will see an output, in this case, a file named "javascript-from-demo\_notsuspicious" (highlighted in yellow). This file now contains our extracted Javascript, we can simply `cat` this to see the contents.\
![](https://i.imgur.com/zSLNeKV.png)\
\
As it turns out, the PDF file we have analysed contains the javascript code of `app.alert("All your Cooctus are belong to us!")`\
PracticalWe have used `peepdf` to:1. Look for the presence of Javascript2. Extract any contained Javascript for us to read without it being executed.\
![](https://i.imgur.com/gI35CYV.png)\
\
The commands to do so have been used above, you may have to implement them differently, proceed to answer questions 1 - 4 before moving onto the next section.\
Executables\
Of course not only can Javascript be embedded, by executables can be very much too.\
The "advert.pdf" actually has an embedded executable. Looking at the extracted Javascript, we can see the following Javascript snippet:\
![](https://i.imgur.com/HkaEbdF.png)\
\
This tells us that when the PDF is opened, the user will be asked to save an attachment:\


![](https://i.imgur.com/2ABomDi.png)

\
Although PDF attachments can be ZIP files or images, in this case, it is another PDF...Or is it? Well, let's save the file and see what happens. Uh oh...At least that we get a warning that something is trying to execute, but hey, Karen from HR wouldn't send you a dodgy email, right? It's probably a false alarm.\
![](https://i.imgur.com/daoeGoL.png)\
\
Ah...Well, turns out it was. We just got a reverse shell from the Windows PC to my attack machine.\
\
![](https://i.imgur.com/o9mP0CA.png)\
\
It's now obvious (albeit too late for them) that the "pdf" that gets saved isn't a PDF. Let's open it up in a hex editor.\
![](https://i.imgur.com/CSypGSC.png)\
\
Well well well, looks like we have an executable. Let's investigate further by looking at the strings.\


![](https://i.imgur.com/lVmoupA.png)

\
It looks like we have our attacker's IP and port!\


![](https://i.imgur.com/wthxQE3.png)
